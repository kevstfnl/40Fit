{% extends 'base.html.twig' %}

{% block title %}Register{% endblock %}

{% block body %}
    <section
        class="bg-base-200 bg-gradient-to-br from-base-200 via-base-100 to-base-200 relative flex items-center justify-center py-20 px-4">
        <div class="absolute -top-16 -right-16 w-72 h-72 bg-secondary/25 rounded-full blur-xl"></div>
        <div class="absolute -bottom-20 -left-16 w-80 h-80 bg-primary/25 rounded-full blur-xl"></div>
        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[34rem] h-[34rem] bg-secondary/10 rounded-full blur-3xl"></div>

        <div class="relative z-10 gap-6 w-full max-w-5xl grid grid-cols-1 lg:grid-cols-2">
            <div class="card bg-base-100 shadow-xl border border-base-200/60">
                <div class="card-body gap-4">
                    <div class="flex items-center justify-between gap-4">
                        <h2 class="card-title">Profil</h2>
                        <a href="{{ path('profile_edit') }}" class="btn btn-outline btn-sm">Editer</a>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="avatar placeholder">
                            <div class="grid place-items-center bg-primary/10 text-primary rounded-full w-12">
                                <span class="font-semibold">
                                    {{ app.user.firstName|slice(0, 1) }}{{ app.user.lastName|slice(0, 1) }}
                                </span>
                            </div>
                        </div>
                        <div>
                            <p class="text-lg font-semibold">{{ app.user.firstName }} {{ app.user.lastName }}</p>
                            <p class="text-sm opacity-70">{{ app.user.email }}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3 text-xs uppercase tracking-wide opacity-60">
                        <span class="badge badge-ghost">Membre</span>
                        <span class="badge badge-ghost">Actif</span>
                    </div>
                </div>
            </div>

            <div class="card bg-base-100 shadow-xl border border-base-200/60">
                <div class="card-body gap-4">
                    <div class="flex items-center justify-between gap-4">
                        <h2 class="card-title">Résultats</h2>
                        <span class="badge badge-outline">{{ results|length }} score(s)</span>
                    </div>
                    {% if results is empty %}
                        <p class="opacity-70">Aucun résultat enregistré.</p>
                    {% else %}
                        <ul class="space-y-3">
                            {% for result in results %}
                                <li class="flex items-center justify-between rounded-xl border border-base-200/60 bg-base-200/40 px-4 py-3">
                                    <span class="font-medium">{{ result.challenge.title }}</span>
                                    <span class="badge badge-primary badge-outline">{{ result.score }}</span>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>


            <div class="card lg:col-span-2 bg-base-100 shadow-xl border border-base-200/60">
                <div class="card-body gap-4">
                    <div class="flex items-center justify-between gap-4">
                        <h2 class="card-title">Challenges à faire</h2>
                        <span class="badge badge-outline">{{ pendingChallengesCount }} en attente</span>
                    </div>
                    <p class="text-sm opacity-70">Recherchez vos prochains challenges et lancez-vous.</p>
                    {{ form_start(formSearch, { 'attr': {"class": "flex items-center gap-3"}}) }}

                    <label class="input input-bordered flex items-center gap-3 w-full">
                        <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g
                                stroke-linejoin="round"
                                stroke-linecap="round"
                                stroke-width="2.5"
                                fill="none"
                                stroke="currentColor"
                            >
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.3-4.3"></path>
                            </g>
                        </svg>
                        {{ form_row(formSearch.searchInput) }}
                    </label>
                    {{ form_row(formSearch.search, { 'attr': {"class": "btn btn-primary"}}) }}
                    {{ form_end(formSearch) }}
                    {% if pendingChallengesCount == 0 %}
                        <p class="text-sm opacity-60">Aucun challenge disponible pour enregistrer un résultat.</p>
                    {% endif %}
                </div>
            </div>

            {% if groupedPendingChallenges is empty %}
                <p class="opacity-70">Tous les challenges ont un résultat.</p>
            {% else %}
                <div class="space-y-6 lg:col-span-2">
                    {% for group in groupedPendingChallenges %}
                        <h3 class="text-base font-semibold">{{ group.title }}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            {% for challenge in group.items %}
                                <article class="card bg-base-100 shadow-xl border border-base-200/60 overflow-hidden">
                                    <div class="card-body gap-4">
                                        <div class="flex items-start justify-between gap-3">
                                            <span class="badge badge-outline badge-secondary">
                                                {{ challenge.category.title }}
                                            </span>
                                            <span class="badge badge-primary badge-outline">A faire</span>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-semibold leading-snug">{{ challenge.title }}</h3>
                                            <p class="mt-2 text-sm opacity-70 leading-relaxed">
                                                {{ challenge.description }}
                                            </p>
                                        </div>
                                        <div class="card-actions justify-between items-center mt-auto">
                                            <span class="text-xs uppercase tracking-wide opacity-60">Challenge</span>
                                            <a class="btn btn-primary btn-sm" href="{{ path('challenges_show', {'slug': challenge.slug}) }}">
                                                Commencer
                                            </a>
                                        </div>
                                    </div>
                                </article>
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </section>
{% endblock %}
